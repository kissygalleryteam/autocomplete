/*!build time : 2015-03-24 2:40:36 PM*/
function renderKmc(a){var b=a.map(function(a){return{src:pkg+"/"+a+".js",dest:a+comboSuffix+".js"}}),c=a.map(function(a){return{src:a+comboSuffix+".js",outputModule:pkg+"/"+a}});return gulp.src([src+"/**/*.js","!./node_modules/**/*.js","!./test/**/*.js","!./gulpfile.js","!./build/**/*.js"]).pipe(kmc.convert({kissy:!0,ignoreFiles:["-min.js"]})).pipe(kmc.combo({deps:"mods.js",files:b})).pipe(kclean({files:c})).pipe(minify()).pipe(filter(function(b){var c=a.map(function(a){return a+comboSuffix+".js"});return-1==c.indexOf(b.relative)})).pipe(rename(function(b){a.forEach(function(a){b.basename=b.basename.replace(a+comboSuffix+"-min",a+"-min")})})).pipe(gulp.dest(dest))}var gulp=require("gulp"),kmc=require("gulp-kmc"),less=require("gulp-less"),css=require("gulp-mini-css"),kclean=require("gulp-kclean"),rename=require("gulp-rename"),filter=require("gulp-filter"),minify=require("gulp-minify"),XTemplate=require("xtemplate"),gulpXTemplate=require("gulp-xtemplate"),src=".",dest="./build",root=process.cwd(),bower=require("./bower.json"),version=bower.version,pkg="kg/"+path.basename(root)+"/"+version,comboSuffix="-combo";kmc.config({packages:[{name:pkg,base:src}]}),gulp.task("kmc",function(){renderKmc(["index"])}),gulp.task("mini-css",function(){return gulp.src([src+"/**/*.css","!./node_modules/**/*.css","!./build/**/*.css"]).pipe(gulp.dest(dest)).pipe(css({ext:"-min.css"})).pipe(gulp.dest(dest))}),gulp.task("less",function(){return gulp.src([src+"/**/*.less","!./node_modules/**/*.less"]).pipe(less()).pipe(gulp.dest(src))}),gulp.task("css",["less","mini-css"]),gulp.task("xtpl",function(){return gulp.src(src+"/**/*.xtpl").pipe(gulpXTemplate({wrap:"kissy",XTemplate:XTemplate})).on("error",function(a){}).pipe(gulp.dest(src))}),gulp.task("default",["kmc","css"]);